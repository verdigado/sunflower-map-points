{"version":3,"file":"map/map-frontend.js","mappings":"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","sources":["webpack://sunflower-map-points/./src/map/map-frontend.js"],"sourcesContent":["/* global L */\n/* global MutationObserver */\n/* global sunflowerMapPoints */\ndocument.addEventListener( 'DOMContentLoaded', () => {\n\tconst observer = new MutationObserver( () => {\n\t\tdocument.querySelectorAll( '.map-container' ).forEach( ( el ) => {\n\t\t\tif ( typeof L === 'undefined' ) {\n\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\tconsole.error( 'Leaflet is not available' );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst mapEl = el.querySelector( '#map' );\n\n\t\t\tif ( ! mapEl ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( mapEl && mapEl._leaflet_id ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst initLat = parseFloat( el.dataset.lat );\n\t\t\tconst initLng = parseFloat( el.dataset.lng );\n\t\t\tconst initZoom = parseInt( el.dataset.zoom, 10 );\n\n\t\t\tconst map = L.map( mapEl, {\n\t\t\t\tscrollWheelZoom: true,\n\t\t\t\tdragging: true,\n\t\t\t\tfullscreenControl: true,\n\t\t\t} ).setView( [ initLat, initLng ], initZoom );\n\n\t\t\t// Custom \"Locate Me\" Control\n\t\t\tL.Control.LocateControl = L.Control.extend( {\n\t\t\t\tonAdd() {\n\t\t\t\t\tconst container = L.DomUtil.create(\n\t\t\t\t\t\t'div',\n\t\t\t\t\t\t'leaflet-bar leaflet-control leaflet-control-custom'\n\t\t\t\t\t);\n\n\t\t\t\t\tcontainer.innerHTML =\n\t\t\t\t\t\t'<i class=\"fa-solid fa-location-crosshairs\"></i>';\n\t\t\t\t\tcontainer.style.backgroundColor = 'white';\n\t\t\t\t\tcontainer.style.width = '34px';\n\t\t\t\t\tcontainer.style.height = '34px';\n\t\t\t\t\tcontainer.style.display = 'flex';\n\t\t\t\t\tcontainer.style.alignItems = 'center';\n\t\t\t\t\tcontainer.style.justifyContent = 'center';\n\t\t\t\t\tcontainer.style.cursor = 'pointer';\n\n\t\t\t\t\tcontainer.onclick = function () {\n\t\t\t\t\t\tmap.locate( { setView: true, maxZoom: 15 } );\n\t\t\t\t\t};\n\n\t\t\t\t\t// Mausinteraktion auf der Karte nicht blockieren\n\t\t\t\t\tL.DomEvent.disableClickPropagation( container );\n\n\t\t\t\t\treturn container;\n\t\t\t\t},\n\t\t\t} );\n\n\t\t\tL.tileLayer( 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tattribution:\n\t\t\t\t\t'&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap contributors</a>',\n\t\t\t} ).addTo( map );\n\n\t\t\tmap.addControl(\n\t\t\t\tnew L.Control.LocateControl( { position: 'topright' } )\n\t\t\t);\n\n\t\t\tmap.on( 'locationfound', function ( e ) {\n\t\t\t\tconst marker = L.marker( e.latlng )\n\t\t\t\t\t.addTo( map )\n\t\t\t\t\t.bindPopup( 'Du bist hier!' )\n\t\t\t\t\t.openPopup();\n\n\t\t\t\tL.circle( e.latlng, {\n\t\t\t\t\tradius: e.accuracy,\n\t\t\t\t\tcolor: '#136aec',\n\t\t\t\t\tfillColor: '#136aec',\n\t\t\t\t\tfillOpacity: 0.2,\n\t\t\t\t} ).addTo( map );\n\n\t\t\t\t// Remove marker of current location after 2 seconds\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tmap.removeLayer( marker );\n\t\t\t\t}, 2000 );\n\t\t\t} );\n\n\t\t\tmap.on( 'locationerror', function ( e ) {\n\t\t\t\t// eslint-disable-next-line no-alert, no-undef\n\t\t\t\talert( 'Standort konnte nicht gefunden werden: ' + e.message );\n\t\t\t} );\n\n\t\t\tlet marker;\n\n\t\t\tmap.on( 'click', function ( e ) {\n\t\t\t\tconst lat = e.latlng.lat.toFixed( 6 );\n\t\t\t\tconst lng = e.latlng.lng.toFixed( 6 );\n\n\t\t\t\t// Entferne vorherigen Marker (optional)\n\t\t\t\tif ( marker ) {\n\t\t\t\t\tmap.removeLayer( marker );\n\t\t\t\t}\n\n\t\t\t\t// Create custom icon\n\t\t\t\tconst customIcon = L.icon( {\n\t\t\t\t\ticonUrl: sunflowerMapPoints.maps_marker,\n\t\t\t\t\ticonSize: [ 25, 41 ],\n\t\t\t\t\ticonAnchor: [ 12, 41 ],\n\t\t\t\t\tpopupAnchor: [ 0, -25 ],\n\t\t\t\t} );\n\n\t\t\t\t// Create marker\n\t\t\t\tmarker = L.marker( [ lat, lng ], { icon: customIcon } ).addTo(\n\t\t\t\t\tmap\n\t\t\t\t);\n\n\t\t\t\t// show form as popup\n\t\t\t\tconst formHtml = `\n\t\t\t\t<form id=\"leaflet-form\">\n\t\t\t\t${ sunflowerMapPoints._nonce }\n\t\t\t\t<input type=\"hidden\" name=\"action\" value=\"send_leaflet_form\">\n\t\t\t\t<input type=\"hidden\" name=\"lat\" value=\"${ lat }\">\n\t\t\t\t<input type=\"hidden\" name=\"lng\" value=\"${ lng }\">\n\t\t\t\t<div class=\"mb-2\">\n\t\t\t\t\t<label>Name (*):<br><input type=\"text\" name=\"name\" required></label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mb-2\">\n\t\t\t\t\t<label>Email (*):<br><input type=\"email\" name=\"email\" required></label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mb-2\">\n\t\t\t\t\t<label>Telefon:<br><input type=\"tel\" name=\"phone\"></label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mb-2\">\n\t\t\t\t\t<label>Thema (*):<br>\n\t\t\t\t\t\t<select id=\"topic\" name=\"topic\">\n\t\t\t\t\t\t\t<option value=\"Sonstiges\">Sonstiges</option>\n\t\t\t\t\t\t\t<option value=\"Baum\">Baum</option>\n\t\t\t\t\t\t\t<option value=\"Bank\">Bank</option>\n\t\t\t\t\t\t\t<option value=\"Abfalleimer\">Abfalleimer</option>\n\t\t\t\t\t\t\t<option value=\"Trinkbrunnen\">Trinkbrunnen</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mb-2\">\n\t\t\t\t\t<label>Hinweis (*):<br><textarea name=\"message\" rows=\"10\" required></textarea></label>\n\t\t\t\t</div>\n\t\t\t\t<button type=\"submit\" class=\"btn btn-primary btn-sm\">Senden</button>\n\t\t\t\t</form>\n\t\t\t\t<div id=\"form-message\" class=\"alert d-none mt-2\" role=\"alert\"></div>\n\t\t\t`;\n\n\t\t\t\t// Popup anzeigen\n\t\t\t\tmarker\n\t\t\t\t\t.bindPopup( formHtml, {\n\t\t\t\t\t\tautoPan: true,\n\t\t\t\t\t\tautoPanPadding: [ 40, 40 ], // sorgt für ausreichend Abstand von Rändern\n\t\t\t\t\t\toffset: [ 0, -10 ], // zentriert Popup besser über Marker\n\t\t\t\t\t} )\n\t\t\t\t\t.openPopup();\n\t\t\t} );\n\n\t\t\tmap.on( 'popupopen', function () {\n\t\t\t\tconst form = document.getElementById( 'leaflet-form' );\n\t\t\t\tif ( form ) {\n\t\t\t\t\tform.addEventListener( 'submit', function ( e ) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tconst formData = new FormData( form );\n\n\t\t\t\t\t\tfetch( sunflowerMapPoints.ajaxurl, {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\tbody: formData,\n\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t.then( ( response ) => response.json() )\n\t\t\t\t\t\t\t.then( ( data ) => {\n\t\t\t\t\t\t\t\tconst popupContent = `\n\t\t\t\t\t\t\t<div class=\"alert alert-success fade-message mb-0\" id=\"popup-message\">\n\t\t\t\t\t\t\t${ data.messageafter }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;\n\n\t\t\t\t\t\t\t\t// Popup-Inhalt ersetzen (statt nur Nachricht unten drunter)\n\t\t\t\t\t\t\t\tmarker.getPopup().setContent( popupContent );\n\n\t\t\t\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\t\t\t\tmap.closePopup();\n\t\t\t\t\t\t\t\t\tif ( marker ) {\n\t\t\t\t\t\t\t\t\t\tmap.removeLayer( marker );\n\t\t\t\t\t\t\t\t\t\tmarker = null;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 8000 );\n\n\t\t\t\t\t\t\t\tform.reset();\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t.catch( () => {\n\t\t\t\t\t\t\t\tconst msgBox =\n\t\t\t\t\t\t\t\t\tdocument.getElementById( 'form-message' );\n\t\t\t\t\t\t\t\tmsgBox.textContent = 'Fehler beim Absenden!';\n\t\t\t\t\t\t\t\tmsgBox.className = 'alert alert-danger mt-2';\n\t\t\t\t\t\t\t\tmsgBox.classList.remove( 'd-none' );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\t\tmap.closePopup();\n\t\t\t\t\t\t\tif ( marker ) {\n\t\t\t\t\t\t\t\tmap.removeLayer( marker );\n\t\t\t\t\t\t\t\tmarker = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 8000 );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t} );\n\n\tobserver.observe( document.body, { childList: true, subtree: true } );\n} );\n"],"names":["document","addEventListener","observer","MutationObserver","querySelectorAll","forEach","el","L","console","error","mapEl","querySelector","_leaflet_id","initLat","parseFloat","dataset","lat","initLng","lng","initZoom","parseInt","zoom","map","scrollWheelZoom","dragging","fullscreenControl","setView","Control","LocateControl","extend","onAdd","container","DomUtil","create","innerHTML","style","backgroundColor","width","height","display","alignItems","justifyContent","cursor","onclick","locate","maxZoom","DomEvent","disableClickPropagation","tileLayer","attribution","addTo","addControl","position","on","e","marker","latlng","bindPopup","openPopup","circle","radius","accuracy","color","fillColor","fillOpacity","setTimeout","removeLayer","alert","message","toFixed","customIcon","icon","iconUrl","sunflowerMapPoints","maps_marker","iconSize","iconAnchor","popupAnchor","formHtml","_nonce","autoPan","autoPanPadding","offset","form","getElementById","preventDefault","formData","FormData","fetch","ajaxurl","method","body","then","response","json","data","popupContent","messageafter","getPopup","setContent","closePopup","reset","catch","msgBox","textContent","className","classList","remove","observe","childList","subtree"],"sourceRoot":""}